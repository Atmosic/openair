zephyr_include_directories(
  controller/include/ble
  controller/include/common
  platform/include
  wsf/include
  wsf/include/util
)

zephyr_link_libraries(
  -L${CMAKE_CURRENT_SOURCE_DIR}
)

if(CONFIG_ATMWSTK_PD50)
  set(ATMWSTK_FLAVOR "PD50")
elseif(CONFIG_ATMWSTK_CPD200)
  set(ATMWSTK_FLAVOR "CPD200")
elseif(CONFIG_ATMWSTK_FULL)
  set(ATMWSTK_FLAVOR "")
else()
  message(DEPRECATION "CONFIG_ATMWSTKLIB will be deprecated in the future, please choose one of CONFIG_ATMWSTK_PD50, CONFIG_ATMWSTK_CPD200, or CONFIG_ATMWSTK_FULL.")
  set(ATMWSTK_FLAVOR "${CONFIG_ATMWSTKLIB}")
endif()

if(CONFIG_ATM_PLF_DEBUG)
  zephyr_link_libraries(blell${ATMWSTK_FLAVOR}_dbg)
else()
  zephyr_link_libraries(blell${ATMWSTK_FLAVOR})
endif()

set(BLE_FULL_STACK_C_FLAGS
  -DBT_VER=14
  -DSCH_CHECK_LIST_INTEGRITY=1
  -DSCH_EVENT_HANDLE_IN_ISR=1
  -DCS_PRESENT=1
  -DCTE_PRESENT=1
  -DPAL_LED_LOGIC_ENA=0
  -DINIT_CENTRAL
  -DINIT_PERIPHERAL
  -DINIT_OBSERVER
  -DINIT_BROADCASTER
  -DINIT_ENCRYPTED
  -DLL_FEAT_PAST=1
  -DLL_FEAT_PC=1
  -DLL_FEAT_BIS=1
  -DLL_FEAT_CIS=1
  -DLL_FEAT_ECU=1
  -DLL_FEAT_ISO=1
  -DLL_FEAT_PAWR=1
  -DLL_FEAT_SLV_PER_ADV=1
  -DLL_FEAT_CS=1
  -DWSF_TOKEN_ENABLED=0
  -DATM34xx_2
  -DBB_CLK_RATE_HZ=1000000
  -DCHCI_TR_CUSTOM=1
  -DUART_BAUD=2000000
  -DUART_HWFC=1
  -DBB_ENABLE_INLINE_ENC_TX=1
  -DBB_ENABLE_INLINE_DEC_RX=1
  -DENABLE_UECC=1
  -DHCI_ENABLE_VS=1
)

set(BLE_CPD200_STACK_C_FLAGS
  -DBT_VER=13
  -DSCH_CHECK_LIST_INTEGRITY=1
  -DSCH_EVENT_HANDLE_IN_ISR=1
  -DCTE_PRESENT=0
  -DPAL_LED_LOGIC_ENA=0
  -DINIT_CENTRAL
  -DINIT_PERIPHERAL
  -DINIT_OBSERVER
  -DINIT_BROADCASTER
  -DINIT_ENCRYPTED
  -DLL_FEAT_PAST=1
  -DLL_FEAT_PC=1
  -DLL_FEAT_BIS=0
  -DLL_FEAT_CIS=0
  -DLL_FEAT_ECU=1
  -DLL_FEAT_ISO=0
  -DLL_FEAT_PAWR=1
  -DLL_FEAT_SLV_PER_ADV=1
  -DWSF_TOKEN_ENABLED=0
  -DATM34xx_2
  -DBB_CLK_RATE_HZ=1000000
  -DCHCI_TR_CUSTOM=1
  -DUART_BAUD=2000000
  -DUART_HWFC=1
  -DBB_ENABLE_INLINE_ENC_TX=1
  -DBB_ENABLE_INLINE_DEC_RX=1
  -DENABLE_UECC=1
  -DHCI_ENABLE_VS=1
)

set(BLE_PD50_STACK_C_FLAGS
  -DBT_VER=14
  -DSCH_CHECK_LIST_INTEGRITY=1
  -DSCH_EVENT_HANDLE_IN_ISR=1
  -DCTE_PRESENT=0
  -DPAL_LED_LOGIC_ENA=0
  -DINIT_PERIPHERAL
  -DINIT_BROADCASTER
  -DINIT_ENCRYPTED
  -DLL_FEAT_PAST=0
  -DLL_FEAT_PC=1
  -DLL_FEAT_BIS=0
  -DLL_FEAT_CIS=0
  -DLL_FEAT_ECU=0
  -DLL_FEAT_ISO=0
  -DLL_FEAT_PAWR=0
  -DLL_FEAT_CS=1
  -DLL_FEAT_SLV_PER_ADV=0
  -DWSF_TOKEN_ENABLED=0
  -DATM34xx_2
  -DBB_CLK_RATE_HZ=1000000
  -DCHCI_TR_CUSTOM=1
  -DUART_BAUD=2000000
  -DUART_HWFC=1
  -DBB_ENABLE_INLINE_ENC_TX=1
  -DBB_ENABLE_INLINE_DEC_RX=1
  -DENABLE_UECC=1
  -DHCI_ENABLE_VS=0
)

set(BLE_NONDEBUG_STACK_C_FLAGS
  -DWSF_BUF_FREE_CHECK_ASSERT=FALSE
  -DWSF_BUF_STATS=FALSE
  -DWSF_CS_STATS=0
  -DWSF_ASSERT_ENABLED=0
)

set(BLE_DEBUG_STACK_C_FLAGS
  -DWSF_TRACE_LEVEL=1
  -DLL_TRACE_ENABLED=1
  -DWSF_TRACE_ENABLED=1
  -DWSF_TRACE_LF_DISABLE=1
  -DTRACE
  -DWSF_BUF_FREE_CHECK_ASSERT=TRUE
  -DWSF_BUF_STATS=TRUE
  -DWSF_CS_STATS=1
  -DWSF_ASSERT_ENABLED=1
)

if(CONFIG_ATM_BLE)
  if(ATMWSTK_FLAVOR STREQUAL "")
    zephyr_compile_definitions(${BLE_FULL_STACK_C_FLAGS})
  elseif(ATMWSTK_FLAVOR STREQUAL "PD50")
    zephyr_compile_definitions(${BLE_PD50_STACK_C_FLAGS})
  elseif(ATMWSTK_FLAVOR STREQUAL "CPD200")
    zephyr_compile_definitions(${BLE_CPD200_STACK_C_FLAGS})
  else()
    message(FATAL_ERROR "Invalid CONFIG_ATMWSTKLIB.")
  endif()
  if(CONFIG_ATM_PLF_DEBUG)
    zephyr_compile_definitions(${BLE_DEBUG_STACK_C_FLAGS})
  else()
    zephyr_compile_definitions(${BLE_NONDEBUG_STACK_C_FLAGS})
  endif()
endif()

if(CONFIG_ATM_PC_CTR)
    zephyr_include_directories(thirdparty/uecc)
    zephyr_compile_definitions(uECC_ENABLE_VLI_API)
endif()
